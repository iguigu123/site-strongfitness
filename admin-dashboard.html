<!doctype html>
<html lang="pt-BR"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin Dashboard • STRONGFITNESS</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>tailwind.config={theme:{extend:{colors:{bg:'#0a0a0a',panel:'#141414',panel2:'#121212',border:'rgba(255,255,255,0.08)',accent:'#e50914',accent2:'#ff3b3b',muted:'#9ea0a6'},boxShadow:{card:'0 10px 24px rgba(0,0,0,.25)'}}}};</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="min-h-screen bg-black bg-center bg-cover bg-fixed text-gray-200" style="background-image:url('./assets/bear-logo.jpg')">
<script>var u=JSON.parse(localStorage.getItem('sf_user')||'null');if(!u||u.role!=='admin'){location.href='./admin-login.html'}</script>
<div class="grid grid-cols-[260px_1fr] min-h-screen">
  <aside class="bg-panel border-r border-[rgba(255,255,255,0.08)]">
    <div class="px-4 py-4 font-extrabold">Admin • STRONGFITNESS</div>
    <nav class="grid gap-2 px-3">
      <a href="#home" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Home</a>
      <a href="#produtos" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Produtos</a>
      <a href="#categorias" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Categorias</a>
      <a href="#pedidos" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Pedidos</a>
      <a href="#usuarios" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Usuários</a>
      <a href="#config" class="px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">Configurações</a>
    </nav>
  </aside>
  <main class="p-5 overflow-y-auto">
    <div class="flex items-center justify-between">
      <div class="text-xl font-bold">Dashboard</div>
      <div class="flex items-center gap-3"><div class="text-sm text-muted" id="admin-name"></div><button id="logout" class="h-10 px-4 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)] hover:-translate-y-0.5 hover:brightness-95 transition">Sair</button></div>
    </div>

    <section id="view-home" class="mt-6">
      <div class="grid md:grid-cols-4 gap-4">
        <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card"><div class="text-sm text-muted">Total de produtos</div><div class="text-2xl font-bold" id="card-produtos">0</div></div>
        <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card"><div class="text-sm text-muted">Total de pedidos</div><div class="text-2xl font-bold" id="card-pedidos">0</div></div>
        <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card"><div class="text-sm text-muted">Total de clientes</div><div class="text-2xl font-bold" id="card-clientes">0</div></div>
        <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card"><div class="text-sm text-muted">Faturamento total</div><div class="text-2xl font-bold" id="card-faturamento">R$ 0,00</div></div>
      </div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card mt-6">
        <div class="font-semibold mb-2">Vendas por dia</div>
        <canvas id="sales-chart" height="120"></canvas>
      </div>
    </section>

    <section id="view-produtos" class="mt-6 hidden">
      <div class="flex items-center justify-between mb-3"><div class="text-lg font-semibold">Produtos</div><div class="flex items-center gap-2"><button id="salvar-alteracoes" class="h-10 px-4 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)] hover:-translate-y-0.5 hover:brightness-95 transition">Salvar alterações</button><button id="novo-produto" class="h-10 px-4 rounded-md bg-gradient-to-b from-accent to-accent2 text-white border border-[#3a0c0f] hover:-translate-y-0.5 hover:brightness-95 transition">Novo Produto</button></div></div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card">
        <div class="flex gap-3 mb-3"><input id="busca-prod" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)] focus:border-[#D40000] w-64" placeholder="Buscar por nome"><select id="filtro-cat" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]"><option value="todos">Todas</option></select><select id="filtro-status" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]"><option value="todos">Status</option><option value="ativo">Ativo</option><option value="inativo">Inativo</option><option value="esgotado">Esgotado</option></select></div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="text-muted">
              <tr><th class="text-left p-2">Imagem</th><th class="text-left p-2">Nome</th><th class="text-left p-2">Categoria</th><th class="text-left p-2">Preço</th><th class="text-left p-2">Estoque</th><th class="text-left p-2">Status</th><th class="text-left p-2">Criado</th><th class="text-left p-2">Ações</th></tr>
            </thead>
            <tbody id="produtos-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="view-categorias" class="mt-6 hidden">
      <div class="text-lg font-semibold mb-3">Categorias</div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card">
        <div class="flex gap-3 mb-3"><input id="cat-nome" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Nova categoria"><button id="cat-add" class="h-10 px-4 rounded-md bg-gradient-to-b from-accent to-accent2 text-white border border-[#3a0c0f]">Adicionar</button></div>
        <div id="cat-list" class="grid gap-2"></div>
      </div>
    </section>

    <section id="view-pedidos" class="mt-6 hidden">
      <div class="text-lg font-semibold mb-3">Pedidos</div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card">
        <div id="order-list" class="grid gap-2"></div>
      </div>
    </section>

    <section id="view-usuarios" class="mt-6 hidden">
      <div class="text-lg font-semibold mb-3">Usuários</div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card">
        <div id="user-list" class="grid gap-2"></div>
      </div>
    </section>

    <section id="view-config" class="mt-6 hidden">
      <div class="text-lg font-semibold mb-3">Configurações</div>
      <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card">
        <div class="grid md:grid-cols-3 gap-3">
          <div class="col-span-1">
            <div class="text-sm text-muted mb-1">Supabase URL</div>
            <input id="sup-url" class="h-10 w-full px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="https://xxxxx.supabase.co">
          </div>
          <div class="col-span-1">
            <div class="text-sm text-muted mb-1">Anon Key</div>
            <input id="sup-key" class="h-10 w-full px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="public anon key">
          </div>
          <div class="col-span-1">
            <div class="text-sm text-muted mb-1">Bucket</div>
            <input id="sup-bucket" class="h-10 w-full px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="images">
          </div>
        </div>
        <div class="mt-3"><button id="sup-save" class="h-10 px-4 rounded-md bg-gradient-to-b from-accent to-accent2 text-white border border-[#3a0c0f]">Salvar</button></div>
      </div>
    </section>
  </main>
</div>

<div id="modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center">
  <div class="bg-panel border border-[rgba(255,255,255,0.08)] rounded-xl p-4 shadow-card w-[720px] max-w-[95%]">
    <div class="text-lg font-semibold mb-2">Produto</div>
      <div class="grid md:grid-cols-2 gap-3">
        <div class="grid gap-2">
          <input id="m-nome" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Nome">
          <textarea id="m-desc" class="h-24 px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Descrição"></textarea>
          <input id="m-preco" type="number" step="0.01" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Preço">
          <select id="m-cat" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]"></select>
          <input id="m-estoque" type="number" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Estoque">
          <select id="m-status" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]"><option value="ativo">Ativo</option><option value="inativo">Inativo</option><option value="esgotado">Esgotado</option></select>
          <div class="grid gap-2">
            <div class="text-sm text-muted">Tamanhos e quantidades</div>
            <div class="flex gap-2">
              <select id="m-size-name" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">
                <option value="P">P</option>
                <option value="M">M</option>
                <option value="G">G</option>
                <option value="GG">GG</option>
              </select>
              <input id="m-size-qty" type="number" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]" placeholder="Qtd">
              <button id="m-size-add" class="h-10 px-3 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]">Adicionar</button>
            </div>
            <div id="m-size-list" class="grid gap-2"></div>
          </div>
          <div class="grid gap-2">
            <div class="text-sm text-muted">Imagem principal</div>
            <input id="m-principal" type="file" accept="image/*" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">
            <img id="m-principal-prev" class="h-28 w-full object-cover rounded-md border border-[rgba(255,255,255,0.08)]" hidden>
          </div>
      </div>
      <div class="grid gap-2">
        <div class="text-sm text-muted">Galeria de imagens</div>
        <input id="m-galeria" type="file" multiple accept="image/*" class="h-10 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]">
        <div id="m-galeria-prev" class="grid grid-cols-3 gap-2"></div>
      </div>
    </div>
    <div class="flex justify-end gap-2 mt-3">
      <button id="m-cancel" class="h-10 px-4 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]">Cancelar</button>
      <button id="m-save" class="h-10 px-4 rounded-md bg-gradient-to-b from-accent to-accent2 text-white border border-[#3a0c0f]">Salvar</button>
    </div>
  </div>
</div>

<script>
function uid(){return crypto.randomUUID?crypto.randomUUID():('id'+Date.now()+Math.floor(Math.random()*1000))}
function money(n){return 'R$ '+Number(n||0).toFixed(2)}
function get(k,d){var r=localStorage.getItem(k);return r?JSON.parse(r):d}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}
function products(){return get('sf_products',[])}
function saveProducts(a){set('sf_products',a)}
function categories(){return get('sf_categories',['oversized','dryfit','conjuntos','lancamentos'])}
function saveCategories(a){set('sf_categories',a)}
function orders(){return get('sf_orders',[])}
function users(){return get('sf_users',[{id:uid(),email:'admin@strongfitness.com',name:'Admin',role:'admin'}])}
function saveUsers(a){set('sf_users',a)}
function supConf(){return get('sf_supabase',null)}
function saveSup(c){set('sf_supabase',c)}
function supClient(){var c=supConf();if(!c||!c.url||!c.key||!window.supabase)return null;return window.supabase.createClient(c.url,c.key)}

function route(){var h=location.hash.replace('#','')||'home';document.getElementById('view-home').classList.toggle('hidden',h!=='home');document.getElementById('view-produtos').classList.toggle('hidden',h!=='produtos');document.getElementById('view-categorias').classList.toggle('hidden',h!=='categorias');document.getElementById('view-pedidos').classList.toggle('hidden',h!=='pedidos');document.getElementById('view-usuarios').classList.toggle('hidden',h!=='usuarios');document.getElementById('view-config').classList.toggle('hidden',h!=='config')}
window.addEventListener('hashchange',route)

document.getElementById('admin-name').textContent=(JSON.parse(localStorage.getItem('sf_user'))||{}).email||'Admin'
document.getElementById('logout').onclick=function(){localStorage.removeItem('sf_user');location.href='./admin-login.html'}

function renderCards(){document.getElementById('card-produtos').textContent=String(products().length);document.getElementById('card-pedidos').textContent=String(orders().length);var unique=(users().filter(function(u){return u.role!=='admin'})).length;document.getElementById('card-clientes').textContent=String(unique);var fat=orders().reduce(function(s,o){var tot=(o.items||[]).reduce(function(ss,i){return ss+i.preco*i.qty},0);return s+tot},0);document.getElementById('card-faturamento').textContent=money(fat)}

function renderChart(){var ctx=document.getElementById('sales-chart');if(!ctx)return;var m=orders().reduce(function(map,o){var d=new Date(o.id).toISOString().slice(0,10);var v=(o.items||[]).reduce(function(ss,i){return ss+i.preco*i.qty},0);map[d]=(map[d]||0)+v;return map},{}) ;var labels=Object.keys(m).sort();var data=labels.map(function(k){return m[k]});new Chart(ctx,{type:'line',data:{labels:labels,datasets:[{label:'Vendas',data:data,borderColor:'#e50914',backgroundColor:'rgba(229,9,20,0.25)'}]},options:{plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,0.06)'}},y:{grid:{color:'rgba(255,255,255,0.06)'}}}}})}

function renderCats(){var list=categories();var host=document.getElementById('cat-list');host.innerHTML='';list.forEach(function(c,idx){var row=document.createElement('div');row.className='flex items-center justify-between px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]';var name=document.createElement('input');name.className='h-9 px-3 rounded-md bg-panel border border-[rgba(255,255,255,0.08)]';name.value=c;name.oninput=function(){list[idx]=name.value};var del=document.createElement('button');del.className='h-9 px-3 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]';del.textContent='Excluir';del.onclick=function(){list.splice(idx,1);saveCategories(list);renderCats();renderProdFilters()};row.appendChild(name);row.appendChild(del);host.appendChild(row)});document.getElementById('cat-add').onclick=function(){var n=document.getElementById('cat-nome').value.trim();if(!n)return;list.push(n);document.getElementById('cat-nome').value='';saveCategories(list);renderCats();renderProdFilters()}}

function renderProdFilters(){var sel=document.getElementById('filtro-cat');sel.innerHTML='<option value="todos">Todas</option>';categories().forEach(function(c){var o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o)});var mcat=document.getElementById('m-cat');mcat.innerHTML='';categories().forEach(function(c){var o=document.createElement('option');o.value=c;o.textContent=c;mcat.appendChild(o)})}

function renderProducts(){var list=products();var q=(document.getElementById('busca-prod').value||'').toLowerCase();var cat=document.getElementById('filtro-cat').value;var st=document.getElementById('filtro-status').value;var tbody=document.getElementById('produtos-tbody');tbody.innerHTML='';list.filter(function(p){var okName=p.nome.toLowerCase().includes(q);var okCat=(cat==='todos')||(p.categoria===cat);var okSt=(st==='todos')||(p.status===st);return okName&&okCat&&okSt}).forEach(function(p){var tr=document.createElement('tr');var img=p.imagem_principal||((p.galeria_de_imagens||[])[0])||'';tr.innerHTML='<td class="p-2"><img src="'+img+'" class="h-10 w-14 object-cover rounded-md border border-[rgba(255,255,255,0.08)]"></td><td class="p-2">'+p.nome+'</td><td class="p-2">'+p.categoria+'</td><td class="p-2">'+money(p.preco)+'</td><td class="p-2">'+(p.estoque||0)+'</td><td class="p-2">'+(p.status||'ativo')+'</td><td class="p-2">'+new Date(p.criado_em).toLocaleString()+'</td><td class="p-2"><button class="h-9 px-3 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]" data-edit="'+p.id+'">Editar</button> <button class="h-9 px-3 rounded-md bg-gradient-to-b from-accent to-accent2 text-white border border-[#3a0c0f]" data-del="'+p.id+'">Excluir</button></td>';tbody.appendChild(tr)});Array.from(tbody.querySelectorAll('[data-edit]')).forEach(function(b){b.onclick=function(){openModal(list.find(function(x){return String(x.id)===String(b.dataset.edit)}))}});Array.from(tbody.querySelectorAll('[data-del]')).forEach(function(b){b.onclick=function(){var id=b.dataset.del;var arr=products().filter(function(x){return String(x.id)!==String(id)});saveProducts(arr);renderProducts();renderCards()}})}

function openModal(p){document.getElementById('modal').classList.remove('hidden');document.getElementById('m-nome').value=p?p.nome:'';document.getElementById('m-desc').value=p?p.descricao||'':'';document.getElementById('m-preco').value=p?p.preco||0:'';document.getElementById('m-cat').value=p?p.categoria||categories()[0]:categories()[0];document.getElementById('m-estoque').value=p?p.estoque||0:'';document.getElementById('m-status').value=p?p.status||'ativo':'ativo';var prev=document.getElementById('m-principal-prev');prev.hidden=true;document.getElementById('m-principal').value='';var galPrev=document.getElementById('m-galeria-prev');galPrev.innerHTML='';var principalUrl='';var galUrls=[];if(p&&p.imagem_principal){principalUrl=p.imagem_principal;prev.src=principalUrl;prev.hidden=false}if(p&&(p.galeria_de_imagens||[]).length){p.galeria_de_imagens.forEach(function(src){var im=document.createElement('img');im.src=src;im.className='h-20 w-full object-cover rounded-md border border-[rgba(255,255,255,0.08)]';galPrev.appendChild(im)})}
var estInp=document.getElementById('m-estoque');var stSel=document.getElementById('m-status');estInp.oninput=function(){var v=Number(estInp.value||0);if(v<=0){stSel.value='esgotado'}}
var sizeData=[];if(p&&p.stock){Object.keys(p.stock).forEach(function(k){sizeData.push({name:k,qty:Number(p.stock[k]||0)})})}else if(p&&p.tamanhos){p.tamanhos.forEach(function(k){sizeData.push({name:k,qty:0})})}
function renderSizeList(){var host=document.getElementById('m-size-list');host.innerHTML='';sizeData.forEach(function(row,idx){var wrap=document.createElement('div');wrap.className='flex items-center gap-2';var name=document.createElement('div');name.className='h-9 px-3 rounded-md bg-panel border border-[rgba(255,255,255,0.08)] flex items-center';name.textContent=row.name;var qty=document.createElement('input');qty.type='number';qty.className='h-9 px-3 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]';qty.value=row.qty;qty.oninput=function(){sizeData[idx].qty=Number(qty.value||0)};var del=document.createElement('button');del.className='h-9 px-3 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]';del.textContent='Remover';del.onclick=function(){sizeData.splice(idx,1);renderSizeList()};wrap.appendChild(name);wrap.appendChild(qty);wrap.appendChild(del);host.appendChild(wrap)});var sum=sizeData.reduce(function(s,r){return s+Number(r.qty||0)},0);if(sum<=0){stSel.value='esgotado'}}
renderSizeList();
document.getElementById('m-size-add').onclick=function(){var n=document.getElementById('m-size-name').value;var q=Number(document.getElementById('m-size-qty').value||0);if(!n)return;var exists=sizeData.find(function(r){return r.name===n});if(exists){exists.qty+=q}else{sizeData.push({name:n,qty:q})}document.getElementById('m-size-qty').value='';renderSizeList()}
function readFile(f,cb){var c=supClient();var conf=supConf();if(c&&conf&&conf.bucket){var path='prod-'+Date.now()+'-'+f.name;c.storage.from(conf.bucket).upload(path,f).then(function(){var url=c.storage.from(conf.bucket).getPublicUrl(path).data.publicUrl;cb(url)}).catch(function(){var r=new FileReader();r.onload=function(){cb(r.result)};r.readAsDataURL(f)})}else{var r=new FileReader();r.onload=function(){cb(r.result)};r.readAsDataURL(f)}}
document.getElementById('m-principal').onchange=function(e){var f=e.target.files[0];if(!f)return;readFile(f,function(url){principalUrl=url;prev.src=url;prev.hidden=false})}
document.getElementById('m-galeria').onchange=function(e){var files=Array.from(e.target.files||[]);if(!files.length)return;galUrls=[];galPrev.innerHTML='';var pending=files.length;files.forEach(function(f){readFile(f,function(url){galUrls.push(url);var im=document.createElement('img');im.src=url;im.className='h-20 w-full object-cover rounded-md border border-[rgba(255,255,255,0.08)]';galPrev.appendChild(im);if(--pending===0){} })})}
document.getElementById('m-cancel').onclick=function(){document.getElementById('modal').classList.add('hidden')}
document.getElementById('m-save').onclick=function(){var nome=document.getElementById('m-nome').value;var desc=document.getElementById('m-desc').value;var preco=Number(document.getElementById('m-preco').value||0);var cat=document.getElementById('m-cat').value;var estoqueInput=Number(document.getElementById('m-estoque').value||0);var status=document.getElementById('m-status').value;var totalSizes=sizeData.reduce(function(s,r){return s+Number(r.qty||0)},0);var estoque=(sizeData.length?totalSizes:estoqueInput);if(estoque<=0)status='esgotado';var tamanhos=(sizeData.length?sizeData.map(function(r){return r.name}):p&&p.tamanhos||[]);var stock=(sizeData.length?sizeData.reduce(function(o,r){o[r.name]=Number(r.qty||0);return o},{}):p&&p.stock||undefined);var arr=products();if(p){var idx=arr.findIndex(function(x){return x.id===p.id});arr[idx]={id:p.id,nome:nome,descricao:desc,preco:preco,categoria:cat,estoque:estoque,status:status,imagem_principal:principalUrl||p.imagem_principal||'',galeria_de_imagens:(galUrls.length?galUrls:(p.galeria_de_imagens||[])),tamanhos:tamanhos,stock:stock,criado_em:p.criado_em||Date.now()} }else{arr.push({id:uid(),nome:nome,descricao:desc,preco:preco,categoria:cat,estoque:estoque,status:status,imagem_principal:principalUrl||'',galeria_de_imagens:galUrls,tamanhos:tamanhos,stock:stock,criado_em:Date.now()})}
saveProducts(arr);document.getElementById('modal').classList.add('hidden');renderProducts();renderCards()}
}

document.getElementById('novo-produto').onclick=function(){openModal(null)}
document.getElementById('busca-prod').oninput=renderProducts
document.getElementById('filtro-cat').onchange=renderProducts
document.getElementById('filtro-status').onchange=renderProducts
document.getElementById('salvar-alteracoes').onclick=function(){saveProducts(products());renderProducts();renderCards();alert('Alterações salvas')}

function renderOrders(){var host=document.getElementById('order-list');host.innerHTML='';orders().slice().reverse().forEach(function(o){var wrap=document.createElement('div');wrap.className='flex items-center justify-between px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]';var tot=(o.items||[]).reduce(function(s,i){return s+i.preco*i.qty},0);var left=document.createElement('div');left.innerHTML='<div class="font-semibold">Pedido #'+o.id+'</div><div class="text-sm text-muted">'+(o.items||[]).length+' itens • '+money(tot)+'</div>';var right=document.createElement('div');var select=document.createElement('select');select.className='h-9 px-3 rounded-md bg-panel border border-[rgba(255,255,255,0.08)]';['Pendente','Pago','Enviado','Entregue'].forEach(function(s){var op=document.createElement('option');op.textContent=s;op.selected=(o.status===s.toLowerCase());select.appendChild(op)});select.onchange=function(){o.status=select.value.toLowerCase();var arr=orders();var idx=arr.findIndex(function(x){return x.id===o.id});arr[idx]=o;set('sf_orders',arr)};var details=document.createElement('button');details.className='h-9 px-3 rounded-md bg-[#1b1b1b] border border-[rgba(255,255,255,0.08)]';details.textContent='Detalhes';details.onclick=function(){alert((o.items||[]).map(function(i){return i.nome+' x'+i.qty}).join('\n'))};right.appendChild(select);right.appendChild(details);wrap.appendChild(left);wrap.appendChild(right);host.appendChild(wrap)})}

function renderUsers(){var host=document.getElementById('user-list');host.innerHTML='';users().forEach(function(us,idx){var row=document.createElement('div');row.className='flex items-center justify-between px-3 py-2 rounded-md bg-panel2 border border-[rgba(255,255,255,0.08)]';var left=document.createElement('div');left.innerHTML='<div class="font-semibold">'+(us.name||us.email)+'</div><div class="text-sm text-muted">'+us.email+'</div>';var sel=document.createElement('select');sel.className='h-9 px-3 rounded-md bg-panel border border-[rgba(255,255,255,0.08)]';['admin','cliente'].forEach(function(r){var op=document.createElement('option');op.value=r;op.textContent=r;op.selected=(us.role===(r==='cliente'?'user':'admin'));sel.appendChild(op)});sel.onchange=function(){us.role=sel.value==='cliente'?'user':'admin';var arr=users();arr[idx]=us;saveUsers(arr)};row.appendChild(left);row.appendChild(sel);host.appendChild(row)})}

document.getElementById('sup-save').onclick=function(){var url=document.getElementById('sup-url').value.trim();var key=document.getElementById('sup-key').value.trim();var bucket=document.getElementById('sup-bucket').value.trim();saveSup({url:url,key:key,bucket:bucket});alert('Configurações salvas')}

function init(){route();renderCards();renderChart();renderCats();renderProdFilters();renderProducts();renderOrders();renderUsers();var sc=supConf();if(sc){document.getElementById('sup-url').value=sc.url||'';document.getElementById('sup-key').value=sc.key||'';document.getElementById('sup-bucket').value=sc.bucket||''}}
document.addEventListener('DOMContentLoaded',init)
</script>
</body></html>